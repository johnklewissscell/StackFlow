<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>StackFlow - Stock Simulator</title>

  <!-- ===== Content Security Policy ===== -->
  <meta http-equiv="Content-Security-Policy"
        content="
          default-src 'self';
          script-src 'self' https://cdn.jsdelivr.net https://s3.tradingview.com 'nonce-STACKFLOW';
          style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
          font-src 'self' https://fonts.gstatic.com;
          connect-src 'self' https://query1.finance.yahoo.com https://cdn.jsdelivr.net;
          img-src 'self' data:;
          object-src 'none';
        ">

  <!-- Fonts -->
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap">

  <!-- Styles -->
  <link rel="stylesheet" href="/publicstyles/application.css" />

  <!-- External libs -->
  <script nonce="STACKFLOW" src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script nonce="STACKFLOW" src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@2/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
  <script nonce="STACKFLOW" src="/publicscripts/chartjs-chart-financial.min.js"></script>
  <script nonce="STACKFLOW" src="https://s3.tradingview.com/tv.js"></script>

  <!-- App logic -->
  <script nonce="STACKFLOW" type="module" src="/publicscripts/application.js"></script>
</head>

<body style="font-family: 'Inter', sans-serif;">

  <!-- Floating auto-refresh -->
  <div id="auto-refresh-control" style="
      position:fixed;bottom:14px;right:14px;background:rgba(0,0,0,0.65);
      color:#fff;padding:8px 10px;border-radius:8px;z-index:1000;">
      <label style="display:flex;gap:8px;">
        <input id="auto-refresh-checkbox" type="checkbox">
        <span>Auto Refresh</span>
      </label>
  </div>

  <!-- Welcome banner -->
  <div id="welcome-banner" style="display:none;margin:30px auto 20px;max-width:1200px;">
    <div style="background:#2c5364;padding:25px;border-radius:12px;color:#fff;">
      <h2>Welcome back, <span id="welcome-username"></span>!</h2>
      <p>Check your stocks and chat with StackAI for insights.</p>
    </div>
  </div>

  <!-- Navbar -->
  <header class="navbar">
    <div class="logo"><img src="/favicon.ico" style="height:60px"></div>

    <nav>
      <ul class="nav-links">
        <li><a href="index.html#">Home</a></li>
        <li><a href="index.html#features">Features</a></li>
        <li><a href="index.html#about">About</a></li>
        <li><a href="index.html#contacts">Contact</a></li>
      </ul>
    </nav>

    <div id="auth-section" class="auth-buttons">
      <button onclick="location.href='login.html'" class="log">Log In</button>
      <button onclick="location.href='signup.html'" class="log">Sign Up</button>
    </div>

    <div id="user-menu" style="display:none;gap:15px;">
      <span id="user-greeting"></span>
      <button id="logout-btn" class="log" style="background:#ff6b6b">Sign Out</button>
    </div>
  </header>

  <div id="toprow" style="display:flex;gap:20px;flex-wrap:wrap;">

    <!-- Stock Controls -->
    <div id="controls" style="width:450px;">
      <input id="symbol" placeholder="Enter stock symbol (AAPL)"><br>

      <div style="margin-top:10px;">
        <button id="getStock" class="specialbutton">Get Price</button>
        <button id="toggleCandle" class="specialbutton" style="margin-left:8px;">Candlestick</button>
      </div>

      <div id="stock-info" style="margin-top:10px;"></div>

      <div id="time-range" style="margin-top:10px;">
        <button data-range="1D" class="specialbutton">1D</button>
        <button data-range="1M" class="specialbutton">1M</button>
        <button data-range="1Y" class="specialbutton">1Y</button>
        <button data-range="5Y" class="specialbutton">5Y</button>
      </div>
    </div>

    <!-- Chat -->
    <div id="chat-panel" style="width:450px;border:1px solid #ccc;padding:12px;">
      <h3>StackAI Chat</h3>
      <div id="chat-messages" style="height:200px;overflow:auto;background:#fafafa;"></div>
      <div style="display:flex;gap:8px;margin-top:8px;">
        <input id="chat-input" placeholder="Ask the AI..." style="flex:1;">
        <button id="chat-send" class="specialbutton">Send</button>
      </div>
      <div id="chat-status" style="font-size:12px;color:#666;margin-top:6px;"></div>
    </div>

    <!-- Chart -->
    <div id="chart-container" style="display:none;height:400px;">
      <canvas id="stockChart"></canvas>
    </div>

  </div>

  <!-- Portfolios -->
  <div id="portfolio-section" style="margin-top:40px;">
    <h2 style="display:flex;justify-content:space-between;">
      Portfolios
      <button id="add-portfolio" style="background:#203a43;color:#fff;padding:6px 12px;">+ New Portfolio</button>
    </h2>

    <div id="portfolios"></div>
  </div>

</body>
</html>
